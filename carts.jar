// cart.js
class ShoppingCart {
    constructor() {
        this.cart = [];
        this.totalPrice = 0;
        this.loadCart();
    }

    loadCart() {
        const savedCart = localStorage.getItem('starProjectCart');
        const savedTotal = localStorage.getItem('starProjectTotal');
        if (savedCart) {
            this.cart = JSON.parse(savedCart);
            this.totalPrice = Number(savedTotal);
            this.updateCartDisplay();
        }
    }

    saveCart() {
        localStorage.setItem('starProjectCart', JSON.stringify(this.cart));
        localStorage.setItem('starProjectTotal', this.totalPrice.toString());
    }

    addItem(item, price) {
        this.cart.push({ item, price });
        this.totalPrice += price;
        this.saveCart();
        this.updateCartDisplay();
        document.querySelector('.cart').classList.add('active');
    }

    removeItem(index) {
        this.totalPrice -= this.cart[index].price;
        this.cart.splice(index, 1);
        this.saveCart();
        this.updateCartDisplay();
    }

    updateCartDisplay() {
        const cartItems = document.getElementById('cartItems');
        cartItems.innerHTML = '';
        this.cart.forEach(({ item, price }, index) => {
            const li = document.createElement('li');
            li.className = 'cart-item';
            li.innerHTML = `
                <div class="cart-item-info">
                    <div class="cart-item-name">${item}</div>
                    <div class="cart-item-price">$UYU ${price}</div>
                </div>
                <i class="fas fa-times remove-item" onclick="shoppingCart.removeItem(${index})"></i>
            `;
            cartItems.appendChild(li);
        });
        document.getElementById('totalPrice').textContent = this.totalPrice;
    }

    checkout() {
        if (this.cart.length === 0) {
            alert('El carrito está vacío');
            return;
        }
        alert(`Total a pagar: $UYU ${this.totalPrice}\nGracias por tu compra!`);
        this.cart = [];
        this.totalPrice = 0;
        this.saveCart();
        this.updateCartDisplay();
        document.querySelector('.cart').classList.remove('active');
    }
}

// Crear instancia del carrito
const shoppingCart = new ShoppingCart();

// Funciones globales
function addToCart(item, price) {
    shoppingCart.addItem(item, price);
}

function showCheckoutForm() {
    shoppingCart.checkout();
}

function minimizeCart(event) {
    event.stopPropagation();
    document.querySelector('.cart').classList.remove('active');
}

// Event Listeners
document.addEventListener('DOMContentLoaded', () => {
    shoppingCart.loadCart();

    document.querySelector('.cart-icon').addEventListener('click', (event) => {
        event.stopPropagation();
        document.querySelector('.cart').classList.toggle('active');
    });

    document.addEventListener('click', (event) => {
        const cart = document.querySelector('.cart');
        if (!cart.contains(event.target)) {
            cart.classList.remove('active');
        }
    });
});

// Actualizar carrito cuando la ventana recibe el foco
window.addEventListener('focus', () => {
    shoppingCart.loadCart();
});
